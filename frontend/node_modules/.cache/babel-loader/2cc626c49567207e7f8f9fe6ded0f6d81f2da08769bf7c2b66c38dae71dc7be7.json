{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport weatherService from '@/services/weather';\nimport xfyunService from '@/services/xfyun';\nconst state = {\n  messages: [],\n  isTyping: false,\n  currentEmotion: 'neutral',\n  weatherInfo: null,\n  soundEnabled: true\n};\nconst getters = {\n  messages: state => state.messages,\n  isTyping: state => state.isTyping,\n  currentEmotion: state => state.currentEmotion,\n  weatherInfo: state => state.weatherInfo\n};\nconst mutations = {\n  addMessage(state, message) {\n    state.messages.push(message);\n  },\n  setTyping(state, isTyping) {\n    state.isTyping = isTyping;\n  },\n  setEmotion(state, emotion) {\n    state.currentEmotion = emotion;\n  },\n  setWeatherInfo(state, info) {\n    state.weatherInfo = info;\n  },\n  toggleSound(state) {\n    state.soundEnabled = !state.soundEnabled;\n  },\n  clearMessages(state) {\n    state.messages = [];\n  }\n};\n\n// 城市别名映射表\nconst cityAliases = {\n  '京': '北京',\n  '沪': '上海',\n  '宁': '南京',\n  '魔都': '上海',\n  '帝都': '北京',\n  '南都': '南京'\n};\n\n// 模糊匹配城市名称\nfunction fuzzyMatchCity(text) {\n  // 首先检查完整城市名\n  for (const city of weatherService.defaultCities) {\n    if (text.includes(city.name)) {\n      return city;\n    }\n  }\n\n  // 检查城市别名\n  for (const [alias, cityName] of Object.entries(cityAliases)) {\n    if (text.includes(alias)) {\n      return weatherService.defaultCities.find(city => city.name === cityName);\n    }\n  }\n\n  // 提取可能的城市名（匹配1-4个汉字）\n  const possibleCities = text.match(/[\\u4e00-\\u9fa5]{1,4}(?:市|区|县)?/g) || [];\n  for (const possibleCity of possibleCities) {\n    // 移除\"市\"、\"区\"、\"县\"等后缀\n    const cleanName = possibleCity.replace(/[市区县]$/, '');\n\n    // 检查是否匹配任何已知城市\n    const matchedCity = weatherService.defaultCities.find(city => city.name.includes(cleanName) || cleanName.includes(city.name));\n    if (matchedCity) {\n      return matchedCity;\n    }\n  }\n  return null;\n}\nconst actions = {\n  async sendMessage({\n    commit\n  }, {\n    text,\n    type = 'user'\n  }) {\n    try {\n      // 添加用户消息\n      commit('addMessage', {\n        text,\n        type\n      });\n      if (type === 'user') {\n        commit('setTyping', true);\n\n        // 分析情绪\n        const emotionResult = await xfyunService.analyzeEmotion(text);\n        commit('setEmotion', emotionResult);\n        console.log('[聊天] 情绪分析结果:', emotionResult);\n\n        // 检查是否是天气查询\n        const weatherPattern = /(查|问|看|怎么样|如何|天气|温度|冷|热|多少度)/;\n        let response = '';\n        if (weatherPattern.test(text)) {\n          console.log('[聊天] 检测到天气查询');\n\n          // 使用模糊匹配查找城市\n          const cityInfo = fuzzyMatchCity(text);\n          if (cityInfo) {\n            console.log('[聊天] 匹配到城市信息:', cityInfo);\n            const weatherInfo = await weatherService.switchCity(cityInfo.id);\n            if (weatherInfo) {\n              commit('setWeatherInfo', weatherInfo);\n              response = weatherService.generateWeatherDescription(weatherInfo);\n            } else {\n              response = '抱歉，获取天气信息失败了，请稍后再试~';\n            }\n          } else {\n            response = `抱歉，我目前只能查询这些城市的天气信息：${weatherService.defaultCities.map(c => c.name).join('、')}`;\n          }\n        } else {\n          // 根据情绪生成回复\n          response = generateResponse(text, emotionResult);\n        }\n\n        // 添加助手回复\n        setTimeout(() => {\n          commit('setTyping', false);\n          commit('addMessage', {\n            text: response,\n            type: 'assistant'\n          });\n        }, 1000);\n      }\n    } catch (error) {\n      console.error('[聊天] 发送消息出错:', error);\n      commit('setTyping', false);\n      commit('addMessage', {\n        text: '抱歉，我遇到了一些问题，请稍后再试~',\n        type: 'assistant'\n      });\n    }\n  }\n};\n\n// 根据情绪生成回复\nfunction generateResponse(text, emotion) {\n  const responses = {\n    positive: ['真好啊！我也感觉很开心呢~ 😊', '你的心情真不错，让我也变得愉快起来了！✨', '太棒了！保持这种好心情哦~ 🌟'],\n    negative: ['别担心，事情总会变好的~ 🌈', '我在这里陪着你呢，要加油哦！💪', '让我们一起想想开心的事吧~ 🌺'],\n    neutral: ['嗯嗯，我明白你的意思~ 🎈', '确实是这样呢！💫', '让我们继续聊下去吧~ ⭐']\n  };\n  const defaultResponses = responses[emotion] || responses.neutral;\n  return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];\n}\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions\n};","map":{"version":3,"names":["weatherService","xfyunService","state","messages","isTyping","currentEmotion","weatherInfo","soundEnabled","getters","mutations","addMessage","message","push","setTyping","setEmotion","emotion","setWeatherInfo","info","toggleSound","clearMessages","cityAliases","fuzzyMatchCity","text","city","defaultCities","includes","name","alias","cityName","Object","entries","find","possibleCities","match","possibleCity","cleanName","replace","matchedCity","actions","sendMessage","commit","type","emotionResult","analyzeEmotion","console","log","weatherPattern","response","test","cityInfo","switchCity","id","generateWeatherDescription","map","c","join","generateResponse","setTimeout","error","responses","positive","negative","neutral","defaultResponses","Math","floor","random","length","namespaced"],"sources":["E:/code/PersonalBolg1/frontend/src/store/modules/chat.js"],"sourcesContent":["import weatherService from '@/services/weather';\nimport xfyunService from '@/services/xfyun';\n\nconst state = {\n  messages: [],\n  isTyping: false,\n  currentEmotion: 'neutral',\n  weatherInfo: null,\n  soundEnabled: true\n};\n\nconst getters = {\n  messages: state => state.messages,\n  isTyping: state => state.isTyping,\n  currentEmotion: state => state.currentEmotion,\n  weatherInfo: state => state.weatherInfo\n};\n\nconst mutations = {\n  addMessage(state, message) {\n    state.messages.push(message);\n  },\n  setTyping(state, isTyping) {\n    state.isTyping = isTyping;\n  },\n  setEmotion(state, emotion) {\n    state.currentEmotion = emotion;\n  },\n  setWeatherInfo(state, info) {\n    state.weatherInfo = info;\n  },\n  toggleSound(state) {\n    state.soundEnabled = !state.soundEnabled;\n  },\n  clearMessages(state) {\n    state.messages = [];\n  }\n};\n\n// 城市别名映射表\nconst cityAliases = {\n  '京': '北京',\n  '沪': '上海',\n  '宁': '南京',\n  '魔都': '上海',\n  '帝都': '北京',\n  '南都': '南京'\n};\n\n// 模糊匹配城市名称\nfunction fuzzyMatchCity(text) {\n  // 首先检查完整城市名\n  for (const city of weatherService.defaultCities) {\n    if (text.includes(city.name)) {\n      return city;\n    }\n  }\n\n  // 检查城市别名\n  for (const [alias, cityName] of Object.entries(cityAliases)) {\n    if (text.includes(alias)) {\n      return weatherService.defaultCities.find(city => city.name === cityName);\n    }\n  }\n\n  // 提取可能的城市名（匹配1-4个汉字）\n  const possibleCities = text.match(/[\\u4e00-\\u9fa5]{1,4}(?:市|区|县)?/g) || [];\n  \n  for (const possibleCity of possibleCities) {\n    // 移除\"市\"、\"区\"、\"县\"等后缀\n    const cleanName = possibleCity.replace(/[市区县]$/, '');\n    \n    // 检查是否匹配任何已知城市\n    const matchedCity = weatherService.defaultCities.find(city => \n      city.name.includes(cleanName) || cleanName.includes(city.name)\n    );\n    \n    if (matchedCity) {\n      return matchedCity;\n    }\n  }\n\n  return null;\n}\n\nconst actions = {\n  async sendMessage({ commit }, { text, type = 'user' }) {\n    try {\n      // 添加用户消息\n      commit('addMessage', { text, type });\n      \n      if (type === 'user') {\n        commit('setTyping', true);\n        \n        // 分析情绪\n        const emotionResult = await xfyunService.analyzeEmotion(text);\n        commit('setEmotion', emotionResult);\n        console.log('[聊天] 情绪分析结果:', emotionResult);\n\n        // 检查是否是天气查询\n        const weatherPattern = /(查|问|看|怎么样|如何|天气|温度|冷|热|多少度)/;\n        let response = '';\n\n        if (weatherPattern.test(text)) {\n          console.log('[聊天] 检测到天气查询');\n          \n          // 使用模糊匹配查找城市\n          const cityInfo = fuzzyMatchCity(text);\n          \n          if (cityInfo) {\n            console.log('[聊天] 匹配到城市信息:', cityInfo);\n            const weatherInfo = await weatherService.switchCity(cityInfo.id);\n            if (weatherInfo) {\n              commit('setWeatherInfo', weatherInfo);\n              response = weatherService.generateWeatherDescription(weatherInfo);\n            } else {\n              response = '抱歉，获取天气信息失败了，请稍后再试~';\n            }\n          } else {\n            response = `抱歉，我目前只能查询这些城市的天气信息：${weatherService.defaultCities.map(c => c.name).join('、')}`;\n          }\n        } else {\n          // 根据情绪生成回复\n          response = generateResponse(text, emotionResult);\n        }\n\n        // 添加助手回复\n        setTimeout(() => {\n          commit('setTyping', false);\n          commit('addMessage', { text: response, type: 'assistant' });\n        }, 1000);\n      }\n    } catch (error) {\n      console.error('[聊天] 发送消息出错:', error);\n      commit('setTyping', false);\n      commit('addMessage', {\n        text: '抱歉，我遇到了一些问题，请稍后再试~',\n        type: 'assistant'\n      });\n    }\n  }\n};\n\n// 根据情绪生成回复\nfunction generateResponse(text, emotion) {\n  const responses = {\n    positive: [\n      '真好啊！我也感觉很开心呢~ 😊',\n      '你的心情真不错，让我也变得愉快起来了！✨',\n      '太棒了！保持这种好心情哦~ 🌟'\n    ],\n    negative: [\n      '别担心，事情总会变好的~ 🌈',\n      '我在这里陪着你呢，要加油哦！💪',\n      '让我们一起想想开心的事吧~ 🌺'\n    ],\n    neutral: [\n      '嗯嗯，我明白你的意思~ 🎈',\n      '确实是这样呢！💫',\n      '让我们继续聊下去吧~ ⭐'\n    ]\n  };\n\n  const defaultResponses = responses[emotion] || responses.neutral;\n  return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}