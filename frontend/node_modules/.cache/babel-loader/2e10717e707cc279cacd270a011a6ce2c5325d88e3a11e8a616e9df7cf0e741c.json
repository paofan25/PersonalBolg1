{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport xfyun from '@/services/xfyun';\nimport weather from '@/services/weather';\nconst state = {\n  messages: [],\n  isTyping: false,\n  currentEmotion: 'neutral',\n  weatherInfo: null,\n  soundEnabled: true\n};\nconst getters = {\n  getAllMessages: state => state.messages,\n  getIsTyping: state => state.isTyping,\n  getCurrentEmotion: state => state.currentEmotion,\n  getWeatherInfo: state => state.weatherInfo,\n  getSoundEnabled: state => state.soundEnabled\n};\nconst mutations = {\n  ADD_MESSAGE(state, message) {\n    state.messages.push({\n      id: Date.now(),\n      timestamp: new Date(),\n      ...message\n    });\n  },\n  SET_TYPING(state, status) {\n    state.isTyping = status;\n  },\n  SET_EMOTION(state, emotion) {\n    state.currentEmotion = emotion;\n  },\n  SET_WEATHER_INFO(state, info) {\n    state.weatherInfo = info;\n  },\n  TOGGLE_SOUND(state) {\n    state.soundEnabled = !state.soundEnabled;\n  },\n  CLEAR_MESSAGES(state) {\n    state.messages = [];\n  }\n};\nconst actions = {\n  async sendMessage({\n    commit\n  }, text) {\n    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n    commit('ADD_MESSAGE', {\n      type: 'user',\n      text\n    });\n\n    // è®¾ç½®æ­£åœ¨è¾“å…¥çŠ¶æ€\n    commit('SET_TYPING', true);\n    try {\n      // åˆ†æžæƒ…ç»ª\n      const emotion = await xfyun.analyzeEmotion(text);\n      commit('SET_EMOTION', emotion);\n\n      // æå–ç”¨æˆ·æŸ¥è¯¢çš„åŸŽå¸‚\n      const cityName = weather.extractCityFromText(text);\n      let response;\n      let weatherInfo = null;\n      if (cityName) {\n        console.log('æ£€æµ‹åˆ°åŸŽå¸‚å:', cityName);\n        // èŽ·å–æŒ‡å®šåŸŽå¸‚çš„å¤©æ°”ä¿¡æ¯\n        weatherInfo = await weather.getNowWeather(cityName);\n        const weatherDescription = weather.generateWeatherDescription(weatherInfo);\n        response = weatherDescription;\n      } else {\n        // ä½¿ç”¨è®¯é£žæœåŠ¡èŽ·å–å›žå¤\n        response = await xfyun.chat([{\n          role: 'system',\n          content: 'ä½ æ˜¯ä¸€ä¸ªå¯çˆ±çš„AIåŠ©æ‰‹ç³–çƒï¼Œæ€§æ ¼æ´»æ³¼å¼€æœ—ï¼Œè¯´è¯æ–¹å¼å¯çˆ±æ¸©æš–ã€‚ä½ ä¼šç”¨emojiè¡¨æƒ…ï¼Œä¼šå…³å¿ƒç”¨æˆ·çš„æƒ…ç»ªçŠ¶æ€ã€‚'\n        }, {\n          role: 'user',\n          content: text\n        }]);\n      }\n\n      // æ·»åŠ åŠ©æ‰‹å›žå¤\n      commit('ADD_MESSAGE', {\n        type: 'assistant',\n        text: response,\n        weather: weatherInfo,\n        actions: generateActions(text, emotion, weatherInfo)\n      });\n    } catch (error) {\n      console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);\n      commit('ADD_MESSAGE', {\n        type: 'assistant',\n        text: 'æŠ±æ­‰ï¼Œæˆ‘çŽ°åœ¨æœ‰ç‚¹ç´¯äº†ï¼Œå¾…ä¼šå†èŠå§~ ðŸ˜´'\n      });\n    } finally {\n      commit('SET_TYPING', false);\n    }\n  },\n  clearChat({\n    commit\n  }) {\n    commit('CLEAR_MESSAGES');\n  }\n};\n\n// æ ¹æ®ç”¨æˆ·è¾“å…¥å’Œæƒ…ç»ªç”Ÿæˆäº’åŠ¨åŠ¨ä½œ\nfunction generateActions(text, emotion, weatherInfo) {\n  const actions = [];\n\n  // æ ¹æ®æƒ…ç»ªæ·»åŠ å®‰æŠšåŠ¨ä½œ\n  if (emotion === 'sad' || emotion === 'worried') {\n    actions.push({\n      type: 'sound',\n      sound: 'purr'\n    });\n    actions.push({\n      type: 'animation',\n      name: 'bounce'\n    });\n  }\n\n  // æ ¹æ®å…³é”®è¯æ·»åŠ ç‰¹å®šåŠ¨ä½œ\n  if (text.includes('è·³èˆž')) {\n    actions.push({\n      type: 'animation',\n      name: 'bounce'\n    });\n  }\n  if (text.includes('éŸ³ä¹') || text.includes('å¬æ­Œ')) {\n    actions.push({\n      type: 'sound',\n      sound: 'music'\n    });\n  }\n\n  // æ ¹æ®å¤©æ°”æ·»åŠ åŠ¨ä½œ\n  if (weatherInfo) {\n    if (weatherInfo.condition === 'rainy') {\n      actions.push({\n        type: 'sound',\n        sound: 'rain'\n      });\n    } else if (weatherInfo.condition === 'sunny') {\n      actions.push({\n        type: 'animation',\n        name: 'happy'\n      });\n    }\n\n    // æ·»åŠ æŸ¥çœ‹å…¶ä»–åŸŽå¸‚å¤©æ°”çš„åŠ¨ä½œ\n    const otherCities = ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·ž', 'æ·±åœ³'];\n    // è¿‡æ»¤æŽ‰å½“å‰åŸŽå¸‚\n    const filteredCities = otherCities.filter(city => city !== weatherInfo.cityName);\n    // æ·»åŠ æŸ¥çœ‹å…¶ä»–åŸŽå¸‚çš„åŠ¨ä½œ\n    filteredCities.slice(0, 3).forEach(city => {\n      actions.push({\n        type: 'cityWeather',\n        cityName: city,\n        label: `æŸ¥çœ‹${city}å¤©æ°”`\n      });\n    });\n  }\n  return actions.length > 0 ? actions : null;\n}\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions\n};","map":{"version":3,"names":["xfyun","weather","state","messages","isTyping","currentEmotion","weatherInfo","soundEnabled","getters","getAllMessages","getIsTyping","getCurrentEmotion","getWeatherInfo","getSoundEnabled","mutations","ADD_MESSAGE","message","push","id","Date","now","timestamp","SET_TYPING","status","SET_EMOTION","emotion","SET_WEATHER_INFO","info","TOGGLE_SOUND","CLEAR_MESSAGES","actions","sendMessage","commit","text","type","analyzeEmotion","cityName","extractCityFromText","response","console","log","getNowWeather","weatherDescription","generateWeatherDescription","chat","role","content","generateActions","error","clearChat","sound","name","includes","condition","otherCities","filteredCities","filter","city","slice","forEach","label","length","namespaced"],"sources":["E:/code/PersonalBolg1/frontend/src/store/modules/chat.js"],"sourcesContent":["import xfyun from '@/services/xfyun';\nimport weather from '@/services/weather';\n\nconst state = {\n  messages: [],\n  isTyping: false,\n  currentEmotion: 'neutral',\n  weatherInfo: null,\n  soundEnabled: true\n};\n\nconst getters = {\n  getAllMessages: state => state.messages,\n  getIsTyping: state => state.isTyping,\n  getCurrentEmotion: state => state.currentEmotion,\n  getWeatherInfo: state => state.weatherInfo,\n  getSoundEnabled: state => state.soundEnabled\n};\n\nconst mutations = {\n  ADD_MESSAGE(state, message) {\n    state.messages.push({\n      id: Date.now(),\n      timestamp: new Date(),\n      ...message\n    });\n  },\n  SET_TYPING(state, status) {\n    state.isTyping = status;\n  },\n  SET_EMOTION(state, emotion) {\n    state.currentEmotion = emotion;\n  },\n  SET_WEATHER_INFO(state, info) {\n    state.weatherInfo = info;\n  },\n  TOGGLE_SOUND(state) {\n    state.soundEnabled = !state.soundEnabled;\n  },\n  CLEAR_MESSAGES(state) {\n    state.messages = [];\n  }\n};\n\nconst actions = {\n  async sendMessage({ commit }, text) {\n    // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯\n    commit('ADD_MESSAGE', {\n      type: 'user',\n      text\n    });\n\n    // è®¾ç½®æ­£åœ¨è¾“å…¥çŠ¶æ€\n    commit('SET_TYPING', true);\n\n    try {\n      // åˆ†æžæƒ…ç»ª\n      const emotion = await xfyun.analyzeEmotion(text);\n      commit('SET_EMOTION', emotion);\n\n      // æå–ç”¨æˆ·æŸ¥è¯¢çš„åŸŽå¸‚\n      const cityName = weather.extractCityFromText(text);\n      let response;\n      let weatherInfo = null;\n\n      if (cityName) {\n        console.log('æ£€æµ‹åˆ°åŸŽå¸‚å:', cityName);\n        // èŽ·å–æŒ‡å®šåŸŽå¸‚çš„å¤©æ°”ä¿¡æ¯\n        weatherInfo = await weather.getNowWeather(cityName);\n        const weatherDescription = weather.generateWeatherDescription(weatherInfo);\n        response = weatherDescription;\n      } else {\n        // ä½¿ç”¨è®¯é£žæœåŠ¡èŽ·å–å›žå¤\n        response = await xfyun.chat([\n          { role: 'system', content: 'ä½ æ˜¯ä¸€ä¸ªå¯çˆ±çš„AIåŠ©æ‰‹ç³–çƒï¼Œæ€§æ ¼æ´»æ³¼å¼€æœ—ï¼Œè¯´è¯æ–¹å¼å¯çˆ±æ¸©æš–ã€‚ä½ ä¼šç”¨emojiè¡¨æƒ…ï¼Œä¼šå…³å¿ƒç”¨æˆ·çš„æƒ…ç»ªçŠ¶æ€ã€‚' },\n          { role: 'user', content: text }\n        ]);\n      }\n\n      // æ·»åŠ åŠ©æ‰‹å›žå¤\n      commit('ADD_MESSAGE', {\n        type: 'assistant',\n        text: response,\n        weather: weatherInfo,\n        actions: generateActions(text, emotion, weatherInfo)\n      });\n\n    } catch (error) {\n      console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', error);\n      commit('ADD_MESSAGE', {\n        type: 'assistant',\n        text: 'æŠ±æ­‰ï¼Œæˆ‘çŽ°åœ¨æœ‰ç‚¹ç´¯äº†ï¼Œå¾…ä¼šå†èŠå§~ ðŸ˜´'\n      });\n    } finally {\n      commit('SET_TYPING', false);\n    }\n  },\n\n  clearChat({ commit }) {\n    commit('CLEAR_MESSAGES');\n  }\n};\n\n// æ ¹æ®ç”¨æˆ·è¾“å…¥å’Œæƒ…ç»ªç”Ÿæˆäº’åŠ¨åŠ¨ä½œ\nfunction generateActions(text, emotion, weatherInfo) {\n  const actions = [];\n\n  // æ ¹æ®æƒ…ç»ªæ·»åŠ å®‰æŠšåŠ¨ä½œ\n  if (emotion === 'sad' || emotion === 'worried') {\n    actions.push({ type: 'sound', sound: 'purr' });\n    actions.push({ type: 'animation', name: 'bounce' });\n  }\n\n  // æ ¹æ®å…³é”®è¯æ·»åŠ ç‰¹å®šåŠ¨ä½œ\n  if (text.includes('è·³èˆž')) {\n    actions.push({ type: 'animation', name: 'bounce' });\n  }\n  if (text.includes('éŸ³ä¹') || text.includes('å¬æ­Œ')) {\n    actions.push({ type: 'sound', sound: 'music' });\n  }\n  \n  // æ ¹æ®å¤©æ°”æ·»åŠ åŠ¨ä½œ\n  if (weatherInfo) {\n    if (weatherInfo.condition === 'rainy') {\n      actions.push({ type: 'sound', sound: 'rain' });\n    } else if (weatherInfo.condition === 'sunny') {\n      actions.push({ type: 'animation', name: 'happy' });\n    }\n    \n    // æ·»åŠ æŸ¥çœ‹å…¶ä»–åŸŽå¸‚å¤©æ°”çš„åŠ¨ä½œ\n    const otherCities = ['åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·ž', 'æ·±åœ³'];\n    // è¿‡æ»¤æŽ‰å½“å‰åŸŽå¸‚\n    const filteredCities = otherCities.filter(city => city !== weatherInfo.cityName);\n    // æ·»åŠ æŸ¥çœ‹å…¶ä»–åŸŽå¸‚çš„åŠ¨ä½œ\n    filteredCities.slice(0, 3).forEach(city => {\n      actions.push({ \n        type: 'cityWeather', \n        cityName: city,\n        label: `æŸ¥çœ‹${city}å¤©æ°”`\n      });\n    });\n  }\n\n  return actions.length > 0 ? actions : null;\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}