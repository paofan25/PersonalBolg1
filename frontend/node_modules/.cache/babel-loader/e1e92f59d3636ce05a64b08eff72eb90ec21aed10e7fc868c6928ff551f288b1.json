{"ast":null,"code":"import { getToken, setToken, removeToken } from '@/utils/auth';\nimport { login, logout, getInfo } from '@/api/user';\n\n// 初始状态\nconst state = {\n  token: getToken(),\n  user: null,\n  loading: false,\n  error: null\n};\n\n// getters\nconst getters = {\n  isLoggedIn: state => !!state.token,\n  currentUser: state => state.user,\n  isLoading: state => state.loading,\n  authError: state => state.error\n};\n\n// mutations\nconst mutations = {\n  SET_TOKEN: (state, token) => {\n    state.token = token;\n  },\n  SET_USER: (state, user) => {\n    state.user = user;\n  },\n  SET_LOADING(state, loading) {\n    state.loading = loading;\n  },\n  SET_ERROR(state, error) {\n    state.error = error;\n  },\n  RESET_STATE: state => {\n    state.token = '';\n    state.user = null;\n    state.error = null;\n  }\n};\n\n// actions\nconst actions = {\n  // 用户登录\n  async login({\n    commit\n  }, userInfo) {\n    const {\n      username,\n      password\n    } = userInfo;\n    try {\n      commit('SET_LOADING', true);\n      commit('SET_ERROR', null);\n      const response = await login({\n        username: username.trim(),\n        password\n      });\n      const {\n        token\n      } = response.data;\n      commit('SET_TOKEN', token);\n      setToken(token);\n\n      // 获取用户信息\n      await commit('getInfo');\n      return response;\n    } catch (error) {\n      commit('SET_ERROR', error.message || '登录失败');\n      throw error;\n    } finally {\n      commit('SET_LOADING', false);\n    }\n  },\n  // 获取用户信息\n  async getInfo({\n    commit,\n    state\n  }) {\n    try {\n      const response = await getInfo(state.token);\n      const {\n        data\n      } = response;\n      commit('SET_USER', data);\n      return data;\n    } catch (error) {\n      commit('SET_ERROR', error.message);\n      throw error;\n    }\n  },\n  // 用户登出\n  async logout({\n    commit\n  }) {\n    try {\n      await logout();\n    } catch (error) {\n      console.error('登出失败:', error);\n    } finally {\n      removeToken();\n      commit('RESET_STATE');\n    }\n  },\n  // 重置 Token\n  resetToken({\n    commit\n  }) {\n    removeToken();\n    commit('RESET_STATE');\n  },\n  async register({\n    commit\n  }, {\n    username,\n    email,\n    password\n  }) {\n    try {\n      commit('SET_LOADING', true);\n      commit('SET_ERROR', null);\n      const {\n        token,\n        user\n      } = await authApi.register(username, email, password);\n      commit('SET_TOKEN', token);\n      commit('SET_USER', user);\n      return user;\n    } catch (error) {\n      commit('SET_ERROR', error.message);\n      throw error;\n    } finally {\n      commit('SET_LOADING', false);\n    }\n  },\n  async fetchUserProfile({\n    commit\n  }) {\n    try {\n      commit('SET_LOADING', true);\n      const user = await authApi.getProfile();\n      commit('SET_USER', user);\n      return user;\n    } catch (error) {\n      commit('SET_ERROR', error.message);\n      throw error;\n    } finally {\n      commit('SET_LOADING', false);\n    }\n  },\n  async updateProfile({\n    commit\n  }, profileData) {\n    try {\n      commit('SET_LOADING', true);\n      const updatedUser = await authApi.updateProfile(profileData);\n      commit('SET_USER', updatedUser);\n      return updatedUser;\n    } catch (error) {\n      commit('SET_ERROR', error.message);\n      throw error;\n    } finally {\n      commit('SET_LOADING', false);\n    }\n  }\n};\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n};","map":{"version":3,"names":["getToken","setToken","removeToken","login","logout","getInfo","state","token","user","loading","error","getters","isLoggedIn","currentUser","isLoading","authError","mutations","SET_TOKEN","SET_USER","SET_LOADING","SET_ERROR","RESET_STATE","actions","commit","userInfo","username","password","response","trim","data","message","console","resetToken","register","email","authApi","fetchUserProfile","getProfile","updateProfile","profileData","updatedUser","namespaced"],"sources":["E:/code/PersonalBolg1/frontend/src/store/modules/auth.js"],"sourcesContent":["import { getToken, setToken, removeToken } from '@/utils/auth'\nimport { login, logout, getInfo } from '@/api/user'\n\n// 初始状态\nconst state = {\n  token: getToken(),\n  user: null,\n  loading: false,\n  error: null\n}\n\n// getters\nconst getters = {\n  isLoggedIn: state => !!state.token,\n  currentUser: state => state.user,\n  isLoading: state => state.loading,\n  authError: state => state.error\n}\n\n// mutations\nconst mutations = {\n  SET_TOKEN: (state, token) => {\n    state.token = token\n  },\n  SET_USER: (state, user) => {\n    state.user = user\n  },\n  SET_LOADING(state, loading) {\n    state.loading = loading\n  },\n  SET_ERROR(state, error) {\n    state.error = error\n  },\n  RESET_STATE: (state) => {\n    state.token = ''\n    state.user = null\n    state.error = null\n  }\n}\n\n// actions\nconst actions = {\n  // 用户登录\n  async login({ commit }, userInfo) {\n    const { username, password } = userInfo\n    try {\n      commit('SET_LOADING', true)\n      commit('SET_ERROR', null)\n      \n      const response = await login({ username: username.trim(), password })\n      const { token } = response.data\n      commit('SET_TOKEN', token)\n      setToken(token)\n      \n      // 获取用户信息\n      await commit('getInfo')\n      \n      return response\n    } catch (error) {\n      commit('SET_ERROR', error.message || '登录失败')\n      throw error\n    } finally {\n      commit('SET_LOADING', false)\n    }\n  },\n\n  // 获取用户信息\n  async getInfo({ commit, state }) {\n    try {\n      const response = await getInfo(state.token)\n      const { data } = response\n      commit('SET_USER', data)\n      return data\n    } catch (error) {\n      commit('SET_ERROR', error.message)\n      throw error\n    }\n  },\n\n  // 用户登出\n  async logout({ commit }) {\n    try {\n      await logout()\n    } catch (error) {\n      console.error('登出失败:', error)\n    } finally {\n      removeToken()\n      commit('RESET_STATE')\n    }\n  },\n\n  // 重置 Token\n  resetToken({ commit }) {\n    removeToken()\n    commit('RESET_STATE')\n  },\n  \n  async register({ commit }, { username, email, password }) {\n    try {\n      commit('SET_LOADING', true)\n      commit('SET_ERROR', null)\n      \n      const { token, user } = await authApi.register(username, email, password)\n      \n      commit('SET_TOKEN', token)\n      commit('SET_USER', user)\n      \n      return user\n    } catch (error) {\n      commit('SET_ERROR', error.message)\n      throw error\n    } finally {\n      commit('SET_LOADING', false)\n    }\n  },\n  \n  async fetchUserProfile({ commit }) {\n    try {\n      commit('SET_LOADING', true)\n      const user = await authApi.getProfile()\n      commit('SET_USER', user)\n      return user\n    } catch (error) {\n      commit('SET_ERROR', error.message)\n      throw error\n    } finally {\n      commit('SET_LOADING', false)\n    }\n  },\n  \n  async updateProfile({ commit }, profileData) {\n    try {\n      commit('SET_LOADING', true)\n      const updatedUser = await authApi.updateProfile(profileData)\n      commit('SET_USER', updatedUser)\n      return updatedUser\n    } catch (error) {\n      commit('SET_ERROR', error.message)\n      throw error\n    } finally {\n      commit('SET_LOADING', false)\n    }\n  }\n}\n\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  actions,\n  mutations\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}